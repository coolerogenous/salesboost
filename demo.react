import React, { useState, useEffect } from 'react';
import { 
  Users, 
  ClipboardList, 
  Upload, 
  CheckCircle, 
  XCircle, 
  Trophy, 
  BarChart3, 
  Plus, 
  User, 
  ShieldCheck,
  Image as ImageIcon,
  Clock,
  Bell,
  Trash2,
  Edit,
  Save,
  Search,
  Lock,
  Eye,
  EyeOff,
  FileText,
  Calendar
} from 'lucide-react';

// --- æ¨¡æ‹Ÿæ•°æ® (Mock Data) ---

const MOCK_USERS = [
  { id: '1001', name: 'ç‹é”€å† ', role: 'employee', points: 1250, avatar: 'ğŸ‘‘', password: '123456' },
  { id: '1002', name: 'ææ–°äºº', role: 'employee', points: 450, avatar: 'ğŸ‘¨â€ğŸ’¼', password: '123456' },
  { id: '1003', name: 'å¼ åŠªåŠ›', role: 'employee', points: 890, avatar: 'ğŸ‘©â€ğŸ’¼', password: '123456' },
  { id: 'admin', name: 'é”€å”®æ€»ç›‘', role: 'admin', points: 0, avatar: 'ğŸ›¡ï¸', password: 'admin' },
];

const INITIAL_TASKS = [
  { 
    id: 1, 
    title: 'æœ‹å‹åœˆè½¬å‘æ–°å“æµ·æŠ¥', 
    desc: 'è¯·è½¬å‘æœ€æ–°çš„å¤å­£æ–°å“æµ·æŠ¥ï¼Œæ–‡æ¡ˆéœ€åŒ…å«â€œé™æ—¶æŠ˜æ‰£â€å­—æ ·ï¼Œä¿ç•™è‡³å°‘4å°æ—¶ã€‚å»ºè®®é…æ–‡ï¼šğŸ”¥å¤å­£å¿…å¤‡ï¼Œé™æ—¶3å¤©5æŠ˜èµ·ï¼æ‰‹æ…¢æ— ï¼', 
    points: 50, 
    deadline: '2023-12-31', 
    type: 'æœ‹å‹åœˆ',
    status: 'active',
    taskImage: null 
  },
  { 
    id: 2, 
    title: 'æ ¸å¿ƒå®¢æˆ·ç¾¤å‘é—®å€™', 
    desc: 'å‘æ‚¨çš„æ ¸å¿ƒAç±»å®¢æˆ·å‘é€å‘¨æœ«é—®å€™ï¼Œå¹¶é™„å¸¦æ´»åŠ¨é“¾æ¥ã€‚é‡ç‚¹å¼ºè°ƒæˆ‘ä»¬çš„VIPæœåŠ¡å‡çº§ã€‚', 
    points: 30, 
    deadline: '2023-12-30', 
    type: 'ç¤¾ç¾¤',
    status: 'active',
    taskImage: null 
  },
  { 
    id: 3, 
    title: 'è¿‡æœŸä»»åŠ¡ç¤ºä¾‹', 
    desc: 'è¿™æ˜¯ä¸€ä¸ªå·²ç»è¿‡æœŸçš„æµ‹è¯•ä»»åŠ¡ã€‚', 
    points: 10, 
    deadline: '2023-01-01', 
    type: 'å…¶ä»–',
    status: 'closed', // åˆå§‹çŠ¶æ€æ¨¡æ‹Ÿè¿‡æœŸ
    taskImage: null 
  },
];

const INITIAL_SUBMISSIONS = [
  { id: 101, taskId: 1, userId: '1001', userName: 'ç‹é”€å† ', status: 'approved', imageUrl: 'placeholder', note: 'å·²è½¬å‘ï¼Œç‚¹èµè¶…è¿‡20ä¸ª', time: '2023-10-24 10:00' },
  { id: 102, taskId: 1, userId: '1002', userName: 'ææ–°äºº', status: 'pending', imageUrl: 'placeholder', note: 'åˆšå‘çš„ï¼Œè¯·æŸ¥æ”¶', time: '2023-10-24 11:30' },
];

// --- ç»„ä»¶éƒ¨åˆ† ---

export default function SalesBoostApp() {
  // å…¨å±€çŠ¶æ€
  const [currentUser, setCurrentUser] = useState(null);
  const [users, setUsers] = useState(MOCK_USERS);
  const [tasks, setTasks] = useState(INITIAL_TASKS);
  const [submissions, setSubmissions] = useState(INITIAL_SUBMISSIONS);
  const [activeTab, setActiveTab] = useState('tasks');
  const [notification, setNotification] = useState(null);

  // åˆå§‹åŒ–æ£€æŸ¥ä»»åŠ¡è¿‡æœŸçŠ¶æ€
  useEffect(() => {
    const checkExpiry = () => {
      const today = new Date().toISOString().split('T')[0];
      setTasks(prevTasks => prevTasks.map(task => {
        if (task.status === 'active' && task.deadline < today) {
          return { ...task, status: 'closed' };
        }
        return task;
      }));
    };
    checkExpiry();
  }, []);

  // æ˜¾ç¤ºé€šçŸ¥
  const showToast = (msg, type = 'success') => {
    setNotification({ msg, type });
    setTimeout(() => setNotification(null), 3000);
  };

  // ç™»å½•å¤„ç†
  const handleLogin = (userId, password) => {
    const user = users.find(u => u.id === userId);
    
    if (!user) {
      showToast('å·¥å·ä¸å­˜åœ¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜', 'error');
      return;
    }

    if (user.password !== password) {
      showToast('å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
      return;
    }

    setCurrentUser(user);
    setActiveTab(user.role === 'admin' ? 'audit' : 'tasks');
    showToast(`æ¬¢è¿å›æ¥ï¼Œ${user.name}`);
  };

  // é€€å‡ºç™»å½•
  const handleLogout = () => {
    setCurrentUser(null);
  };

  // æäº¤ä»»åŠ¡å‡­è¯ (æ›´æ–°ï¼šæ”¯æŒå¤‡æ³¨)
  const handleSubmitProof = (taskId, note, imageFile) => {
    const newSubmission = {
      id: Date.now(),
      taskId,
      userId: currentUser.id,
      userName: currentUser.name,
      status: 'pending',
      imageUrl: imageFile ? 'uploaded_image' : 'placeholder', // æ¨¡æ‹Ÿå›¾ç‰‡
      note: note || '',
      time: new Date().toLocaleString()
    };
    setSubmissions([newSubmission, ...submissions]);
    showToast('å‡­è¯æäº¤æˆåŠŸï¼Œç­‰å¾…å®¡æ ¸');
  };

  // å®¡æ ¸ä»»åŠ¡
  const handleAudit = (submissionId, status) => {
    const targetSub = submissions.find(s => s.id === submissionId);
    if (!targetSub) return;

    // æ›´æ–°æäº¤çŠ¶æ€
    const updatedSubmissions = submissions.map(s => 
      s.id === submissionId ? { ...s, status } : s
    );
    setSubmissions(updatedSubmissions);

    // å¦‚æœé€šè¿‡ï¼ŒåŠ ç§¯åˆ†
    if (status === 'approved') {
      const task = tasks.find(t => t.id === targetSub.taskId);
      const pointsToAdd = task ? task.points : 0;
      
      const updatedUsers = users.map(u => 
        u.id === targetSub.userId ? { ...u, points: u.points + pointsToAdd } : u
      );
      setUsers(updatedUsers);
      showToast(`å®¡æ ¸é€šè¿‡ï¼Œ${targetSub.userName} ç§¯åˆ† +${pointsToAdd}`);
    } else {
      showToast('å·²é©³å›è¯¥ç”³è¯·', 'info');
    }
  };

  // ç®¡ç†å‘˜ï¼šä»»åŠ¡ CRUD
  const handleCreateTask = (newTask) => {
    setTasks([{ ...newTask, id: Date.now(), status: 'active' }, ...tasks]);
    showToast('ä»»åŠ¡å‘å¸ƒæˆåŠŸ');
  };

  const handleUpdateTask = (updatedTask) => {
    setTasks(tasks.map(t => t.id === updatedTask.id ? updatedTask : t));
    showToast('ä»»åŠ¡æ›´æ–°æˆåŠŸ');
  };

  const handleDeleteTask = (taskId) => {
    if (window.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
      setTasks(tasks.filter(t => t.id !== taskId));
      showToast('ä»»åŠ¡å·²åˆ é™¤');
    }
  };

  // ç®¡ç†å‘˜ï¼šäººå‘˜ CRUD
  const handleAddUser = (newUser) => {
    if (users.some(u => u.id === newUser.id)) {
      showToast('è¯¥å·¥å·å·²å­˜åœ¨', 'error');
      return;
    }
    const userToAdd = {
      ...newUser,
      points: 0,
      avatar: 'ğŸ‘¤',
      password: newUser.password || '123456'
    };
    setUsers([...users, userToAdd]);
    showToast('äººå‘˜æ·»åŠ æˆåŠŸï¼Œåˆå§‹å¯†ç : ' + userToAdd.password);
  };

  const handleUpdateUser = (updatedUser) => {
    setUsers(users.map(u => u.id === updatedUser.id ? { ...u, ...updatedUser } : u));
    showToast('äººå‘˜ä¿¡æ¯å·²æ›´æ–°');
  };

  const handleDeleteUser = (userId) => {
    if (window.confirm('ç¡®å®šè¦åˆ é™¤è¯¥äººå‘˜å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
      setUsers(users.filter(u => u.id !== userId));
      showToast('äººå‘˜å·²åˆ é™¤');
    }
  };

  // --- è§†å›¾æ¸²æŸ“ ---

  if (!currentUser) {
    return <LoginScreen users={users} onLogin={handleLogin} />;
  }

  return (
    <div className="flex justify-center items-center min-h-screen bg-gray-100 font-sans text-gray-800">
      {/* æ‰‹æœºå¤–å£³æ¨¡æ‹Ÿ */}
      <div className="relative w-full max-w-md h-[850px] bg-gray-50 shadow-2xl overflow-hidden flex flex-col md:rounded-3xl border border-gray-200">
        
        {/* é¡¶éƒ¨çŠ¶æ€æ  */}
        <div className={`h-14 ${currentUser.role === 'admin' ? 'bg-indigo-900' : 'bg-blue-600'} text-white flex items-center justify-between px-4 shrink-0 shadow-md z-10`}>
          <div className="font-bold text-lg tracking-wide flex items-center gap-2">
            {currentUser.role === 'admin' ? <ShieldCheck size={20}/> : <User size={20}/>}
            {currentUser.role === 'admin' ? 'åŠ©é”€äº‘Â·ç®¡ç†ç«¯' : 'åŠ©é”€äº‘Â·å‘˜å·¥ç«¯'}
          </div>
          <button onClick={handleLogout} className="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30 transition">
            é€€å‡º
          </button>
        </div>

        {/* ä¸»å†…å®¹åŒºåŸŸ - å¯æ»šåŠ¨ */}
        <div className="flex-1 overflow-y-auto no-scrollbar relative bg-gray-50">
          {currentUser.role === 'employee' ? (
            <EmployeeView 
              user={currentUser} 
              activeTab={activeTab} 
              tasks={tasks} 
              submissions={submissions}
              users={users}
              onSubmit={handleSubmitProof}
              showToast={showToast}
            />
          ) : (
            <AdminView 
              activeTab={activeTab}
              tasks={tasks}
              submissions={submissions}
              users={users}
              onAudit={handleAudit}
              onCreateTask={handleCreateTask}
              onUpdateTask={handleUpdateTask}
              onDeleteTask={handleDeleteTask}
              onAddUser={handleAddUser}
              onUpdateUser={handleUpdateUser}
              onDeleteUser={handleDeleteUser}
              showToast={showToast}
            />
          )}
        </div>

        {/* åº•éƒ¨å¯¼èˆªæ  */}
        <BottomNav 
          role={currentUser.role} 
          activeTab={activeTab} 
          setActiveTab={setActiveTab} 
          pendingCount={submissions.filter(s => s.status === 'pending').length}
        />

        {/* å…¨å±€ Toast é€šçŸ¥ */}
        {notification && (
          <div className="absolute top-16 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg text-sm animate-fade-in-down z-50 flex items-center gap-2">
            {notification.type === 'success' ? <CheckCircle size={16} className="text-green-400"/> : <Bell size={16} />}
            {notification.msg}
          </div>
        )}
      </div>
    </div>
  );
}

// --- ç™»å½•ç•Œé¢ ---
function LoginScreen({ users, onLogin }) {
  const [inputId, setInputId] = useState('');
  const [inputPassword, setInputPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  
  return (
    <div className="flex justify-center items-center min-h-screen bg-gray-100">
      <div className="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl space-y-6 m-4">
        <div className="text-center space-y-2">
          <div className="w-16 h-16 bg-blue-600 rounded-2xl mx-auto flex items-center justify-center shadow-lg transform rotate-3">
            <BarChart3 className="text-white w-8 h-8" />
          </div>
          <h1 className="text-2xl font-bold text-gray-900">åŠ©é”€äº‘åŠ©æ‰‹</h1>
          <p className="text-gray-500 text-sm">ä¼ä¸šå†…éƒ¨é”€å”®æ•ˆèƒ½ç®¡ç†ç³»ç»Ÿ</p>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">å·¥å· / Employee ID</label>
            <div className="relative">
              <input 
                type="text" 
                value={inputId}
                onChange={(e) => setInputId(e.target.value)}
                className="w-full pl-4 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition outline-none"
                placeholder="è¯·è¾“å…¥å·¥å·"
              />
            </div>
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">å¯†ç  / Password</label>
            <div className="relative">
              <input 
                type={showPassword ? "text" : "password"}
                value={inputPassword}
                onChange={(e) => setInputPassword(e.target.value)}
                className="w-full pl-4 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition outline-none"
                placeholder="è¯·è¾“å…¥å¯†ç "
              />
              <button 
                onClick={() => setShowPassword(!showPassword)}
                className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
              >
                {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
              </button>
            </div>
          </div>

          <button 
            onClick={() => onLogin(inputId, inputPassword)}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition transform active:scale-95"
          >
            å®‰å…¨ç™»å½•
          </button>
        </div>

        <div className="pt-6 border-t border-gray-100">
          <p className="text-xs text-center text-gray-400 mb-3">â€”â€” å¿«é€Ÿæµ‹è¯•å…¥å£ (é¢„è®¾å¯†ç : 123456) â€”â€”</p>
          <div className="grid grid-cols-2 gap-3">
            <button onClick={() => { setInputId('1001'); setInputPassword('123456'); }} className="px-3 py-2 bg-gray-100 text-gray-600 text-xs rounded hover:bg-gray-200">
              æˆ‘æ˜¯å‘˜å·¥ (1001)
            </button>
            <button onClick={() => { setInputId('admin'); setInputPassword('admin'); }} className="px-3 py-2 bg-indigo-50 text-indigo-600 text-xs rounded hover:bg-indigo-100">
              æˆ‘æ˜¯ç®¡ç†å‘˜ (admin)
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

// --- å‘˜å·¥è§†å›¾ ---
function EmployeeView({ user, activeTab, tasks, submissions, users, onSubmit, showToast }) {
  if (activeTab === 'tasks') return <EmployeeTaskHall tasks={tasks} submissions={submissions} userId={user.id} onSubmit={onSubmit} showToast={showToast} />;
  if (activeTab === 'rank') return <Leaderboard users={users} currentUser={user} />;
  if (activeTab === 'profile') return <EmployeeProfile user={user} submissions={submissions} />;
  return null;
}

function EmployeeTaskHall({ tasks, submissions, userId, onSubmit, showToast }) {
  const [filter, setFilter] = useState('todo'); // todo, done

  const getTaskStatus = (task) => {
    // å¦‚æœä»»åŠ¡æ˜¯å…³é—­çŠ¶æ€ï¼Œä¸”ç”¨æˆ·æ²¡æœ‰å®Œæˆå®ƒï¼Œé‚£ä¹ˆå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯ä¸å¯åšçš„
    const sub = submissions.find(s => s.taskId === task.id && s.userId === userId);
    
    if (task.status === 'closed') {
      if (!sub) return 'expired'; // è¿‡æœŸæœªå®Œæˆ
    }

    if (!sub) return 'unclaimed';
    return sub.status;
  };

  const displayedTasks = tasks.filter(task => {
    const status = getTaskStatus(task);
    if (filter === 'todo') {
      // å¾…åŠï¼šæœªé¢†å–ä¸”ä»»åŠ¡æœªè¿‡æœŸï¼Œæˆ–è€…è¢«é©³å›
      return (status === 'unclaimed' && task.status === 'active') || status === 'rejected';
    }
    if (filter === 'done') {
      // å·²åŠï¼šå®¡æ ¸ä¸­ã€å·²é€šè¿‡ã€æˆ–è€…å·²è¿‡æœŸ(æœªå®Œæˆä¹Ÿç®—ä¸€ç§ç»“æŸçŠ¶æ€ï¼Œçœ‹éœ€æ±‚ï¼Œè¿™é‡Œæš‚ä¸æ˜¾ç¤ºè¿‡æœŸæœªå®Œæˆåœ¨å·²åŠ)
      return status === 'pending' || status === 'approved';
    }
    return true;
  });

  return (
    <div className="p-4 space-y-4 pb-20">
      <div className="flex bg-white p-1 rounded-lg shadow-sm border border-gray-100">
        <button 
          onClick={() => setFilter('todo')}
          className={`flex-1 py-2 text-sm font-medium rounded-md transition ${filter === 'todo' ? 'bg-blue-100 text-blue-700' : 'text-gray-500'}`}
        >
          å¾…åŠä»»åŠ¡
        </button>
        <button 
          onClick={() => setFilter('done')}
          className={`flex-1 py-2 text-sm font-medium rounded-md transition ${filter === 'done' ? 'bg-green-100 text-green-700' : 'text-gray-500'}`}
        >
          å·²åŠ/å®¡æ ¸
        </button>
      </div>

      <div className="space-y-4">
        {displayedTasks.length === 0 ? (
          <div className="text-center py-10 text-gray-400">
            <ClipboardList className="w-12 h-12 mx-auto mb-2 opacity-20" />
            <p className="text-sm">æš‚æ— ä»»åŠ¡</p>
          </div>
        ) : (
          displayedTasks.map(task => (
            <TaskCard 
              key={task.id} 
              task={task} 
              status={getTaskStatus(task)} 
              onSubmit={onSubmit}
            />
          ))
        )}
      </div>
    </div>
  );
}

function TaskCard({ task, status, onSubmit }) {
  const [isExpanding, setIsExpanding] = useState(false);
  const [note, setNote] = useState('');
  const [hasImage, setHasImage] = useState(false); // æ¨¡æ‹Ÿæ˜¯å¦æœ‰å›¾ç‰‡ä¸Šä¼ 

  const handleSubmit = () => {
    onSubmit(task.id, note, hasImage);
    setIsExpanding(false);
    setNote('');
    setHasImage(false);
  };

  return (
    <div className={`bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden transition-all duration-300 ${status === 'expired' ? 'opacity-60 bg-gray-50' : ''}`}>
      <div className="flex justify-between items-start mb-2">
        <span className={`inline-block px-2 py-0.5 rounded text-xs font-medium border ${status === 'expired' ? 'bg-gray-200 text-gray-500 border-gray-300' : 'bg-blue-50 text-blue-600 border-blue-100'}`}>
          {task.type}
        </span>
        <span className="font-bold text-orange-500 flex items-center text-sm">
          +{task.points} ç§¯åˆ†
        </span>
      </div>
      <h3 className="font-bold text-gray-800 text-base mb-1">{task.title}</h3>
      <p className="text-gray-500 text-xs mb-3 leading-relaxed">{task.desc}</p>
      
      {/* ä»»åŠ¡å›¾ç‰‡å±•ç¤º (å¦‚æœç®¡ç†å‘˜ä¸Šä¼ äº†) */}
      {task.taskImage && (
        <div className="mb-3 rounded-lg bg-gray-100 h-24 flex items-center justify-center border border-gray-200">
          <ImageIcon className="text-gray-400 w-6 h-6 mr-1"/> 
          <span className="text-gray-400 text-xs">ä»»åŠ¡ç¤ºä¾‹å›¾</span>
        </div>
      )}

      <div className="flex items-center justify-between mt-3 pt-3 border-t border-gray-50">
        <div className="text-xs text-gray-400 flex items-center gap-1">
          <Clock size={12} /> æˆªæ­¢: {task.deadline}
        </div>

        {/* æŒ‰é’®çŠ¶æ€é€»è¾‘ */}
        {(status === 'unclaimed' || status === 'rejected') && task.status === 'active' ? (
           !isExpanding ? (
            <button onClick={() => setIsExpanding(true)} className="px-4 py-1.5 bg-blue-600 text-white text-xs font-medium rounded-lg shadow-sm hover:bg-blue-700 active:scale-95 transition">
              {status === 'rejected' ? 'é‡æ–°æäº¤' : 'å»å®Œæˆ'}
            </button>
           ) : null
        ) : (
          <span className={`text-xs font-medium px-2 py-1 rounded flex items-center gap-1 ${
            status === 'approved' ? 'text-green-600 bg-green-50' : 
            status === 'expired' ? 'text-gray-500 bg-gray-200' :
            'text-yellow-600 bg-yellow-50'
          }`}>
            {status === 'approved' ? <CheckCircle size={12}/> : 
             status === 'expired' ? <XCircle size={12}/> : <Clock size={12}/>}
            {status === 'approved' ? 'å·²é€šè¿‡' : 
             status === 'expired' ? 'å·²è¿‡æœŸ' : 'å®¡æ ¸ä¸­'}
          </span>
        )}
      </div>

      {/* æäº¤è¡¨å•å±•å¼€åŒºåŸŸ */}
      {isExpanding && (
        <div className="mt-3 pt-3 border-t border-blue-100 animate-fade-in-down bg-blue-50/50 rounded-lg p-3">
          <div className="space-y-3">
            <div>
              <label className="text-xs font-medium text-gray-600 mb-1 block">1. ä¸Šä¼ æˆªå›¾å‡­è¯</label>
              <button 
                onClick={() => setHasImage(!hasImage)}
                className={`w-full h-16 border-2 border-dashed rounded-lg flex flex-col items-center justify-center transition ${hasImage ? 'border-green-400 bg-green-50' : 'border-gray-300 bg-white hover:border-blue-400'}`}
              >
                {hasImage ? (
                  <div className="text-green-600 flex items-center gap-1 text-xs font-bold"><CheckCircle size={14}/> å·²é€‰æ‹©å›¾ç‰‡</div>
                ) : (
                  <>
                    <ImageIcon className="text-gray-400 mb-1" size={20} />
                    <span className="text-xs text-gray-400">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</span>
                  </>
                )}
              </button>
            </div>
            
            <div>
              <label className="text-xs font-medium text-gray-600 mb-1 block">2. å¤‡æ³¨è¯´æ˜ (é€‰å¡«)</label>
              <textarea 
                className="w-full text-xs p-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 outline-none bg-white"
                rows="2"
                placeholder="ä¾‹å¦‚ï¼šå·²ç¾¤å‘3ä¸ªç¾¤ï¼Œå…±è®¡500äºº..."
                value={note}
                onChange={(e) => setNote(e.target.value)}
              />
            </div>

            <div className="flex gap-2 pt-1">
              <button onClick={() => setIsExpanding(false)} className="flex-1 py-2 text-xs text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">å–æ¶ˆ</button>
              <button 
                onClick={handleSubmit} 
                disabled={!hasImage}
                className={`flex-1 py-2 text-xs text-white rounded-lg shadow flex items-center justify-center gap-1 ${!hasImage ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}`}
              >
                <Upload size={12} /> ç¡®è®¤æäº¤
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function Leaderboard({ users, currentUser }) {
  const sortedUsers = [...users].filter(u => u.role !== 'admin').sort((a, b) => b.points - a.points);

  return (
    <div className="pb-20">
      <div className="bg-blue-600 p-6 pb-12 rounded-b-3xl text-white text-center shadow-lg mb-[-30px]">
        <h2 className="text-2xl font-bold mb-1">ğŸ† é”€å† æ’è¡Œæ¦œ</h2>
        <p className="text-blue-100 text-xs opacity-80">æ¯æœˆ1å·ç»“ç®—ç»©æ•ˆ</p>
      </div>

      <div className="px-4 space-y-3">
        {sortedUsers.map((u, index) => {
          const isMe = u.id === currentUser.id;
          return (
            <div key={u.id} className={`flex items-center p-4 rounded-xl shadow-sm border ${isMe ? 'bg-yellow-50 border-yellow-200 transform scale-105 ring-2 ring-yellow-100 z-10' : 'bg-white border-gray-100'}`}>
              <div className={`w-8 font-bold text-center ${index < 3 ? 'text-yellow-500 text-xl italic' : 'text-gray-400'}`}>
                {index + 1}
              </div>
              <div className="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-xl mx-3">
                {u.avatar}
              </div>
              <div className="flex-1">
                <div className="font-bold text-gray-800 text-sm">{u.name} {isMe && <span className="text-xs text-blue-500 font-normal">(æˆ‘)</span>}</div>
                <div className="text-xs text-gray-400">å·¥å·: {u.id}</div>
              </div>
              <div className="font-bold text-blue-600 text-lg">{u.points}</div>
            </div>
          )
        })}
      </div>
    </div>
  );
}

function EmployeeProfile({ user, submissions }) {
  const mySubs = submissions.filter(s => s.userId === user.id);
  const approvedCount = mySubs.filter(s => s.status === 'approved').length;

  return (
    <div className="pb-20">
      <div className="bg-white p-6 mb-4 border-b border-gray-100">
        <div className="flex items-center gap-4 mb-6">
          <div className="w-16 h-16 bg-blue-100 text-4xl rounded-full flex items-center justify-center">
            {user.avatar}
          </div>
          <div>
            <h2 className="text-xl font-bold text-gray-900">{user.name}</h2>
            <p className="text-sm text-gray-500">å·¥å·: {user.id} | é”€å”®ä¸€éƒ¨</p>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="bg-blue-50 p-4 rounded-xl text-center">
            <div className="text-xs text-blue-600 mb-1">å½“å‰ç»©æ•ˆåˆ†</div>
            <div className="text-2xl font-bold text-blue-700">{user.points}</div>
          </div>
          <div className="bg-green-50 p-4 rounded-xl text-center">
             <div className="text-xs text-green-600 mb-1">å·²å®Œæˆä»»åŠ¡</div>
             <div className="text-2xl font-bold text-green-700">{approvedCount}</div>
          </div>
        </div>
      </div>

      <div className="px-4">
        <h3 className="font-bold text-gray-800 mb-3 text-sm">æœ€è¿‘åŠ¨æ€</h3>
        <div className="space-y-3">
          {mySubs.length === 0 ? <p className="text-gray-400 text-xs">æš‚æ— è®°å½•</p> : mySubs.map(sub => (
            <div key={sub.id} className="bg-white p-3 rounded-lg border border-gray-100 flex justify-between items-center">
              <div>
                <div className="text-sm font-medium text-gray-700">æäº¤äº†ä»»åŠ¡ #{sub.taskId}</div>
                <div className="text-xs text-gray-400">{sub.time}</div>
              </div>
              <span className={`text-xs px-2 py-1 rounded ${
                sub.status === 'approved' ? 'bg-green-100 text-green-700' : 
                sub.status === 'pending' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'
              }`}>
                {sub.status === 'approved' ? 'å®¡æ ¸é€šè¿‡' : sub.status === 'pending' ? 'å®¡æ ¸ä¸­' : 'å·²é©³å›'}
              </span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// --- ç®¡ç†å‘˜è§†å›¾ ---
function AdminView(props) {
  const { activeTab, tasks, submissions, users, onAudit, onCreateTask, onUpdateTask, onDeleteTask, onAddUser, onUpdateUser, onDeleteUser, showToast } = props;

  if (activeTab === 'audit') return <AdminAudit submissions={submissions} onAudit={onAudit} tasks={tasks} />;
  if (activeTab === 'tasks') return <AdminTaskMgr tasks={tasks} onCreateTask={onCreateTask} onUpdateTask={onUpdateTask} onDeleteTask={onDeleteTask} showToast={showToast} />;
  if (activeTab === 'users') return <AdminUserMgr users={users} onAddUser={onAddUser} onUpdateUser={onUpdateUser} onDeleteUser={onDeleteUser} />;
  if (activeTab === 'stats') return <AdminStats users={users} submissions={submissions} />;
  return null;
}

function AdminAudit({ submissions, onAudit, tasks }) {
  const pendingList = submissions.filter(s => s.status === 'pending');

  return (
    <div className="p-4 pb-20">
      <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center justify-between">
        å¾…å®¡æ ¸å‡­è¯
        <span className="bg-red-500 text-white text-xs px-2 py-1 rounded-full">{pendingList.length}</span>
      </h2>

      {pendingList.length === 0 ? (
        <div className="bg-white rounded-xl p-8 text-center shadow-sm">
          <CheckCircle className="w-12 h-12 text-green-500 mx-auto mb-3" />
          <p className="text-gray-500">æ‰€æœ‰ä»»åŠ¡å·²å®¡æ ¸å®Œæ¯•</p>
        </div>
      ) : (
        <div className="space-y-4">
          {pendingList.map(sub => {
            const task = tasks.find(t => t.id === sub.taskId);
            return (
              <div key={sub.id} className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div className="p-3 border-b border-gray-50 bg-gray-50 flex justify-between items-center">
                  <span className="text-sm font-bold text-gray-700">{sub.userName}</span>
                  <span className="text-xs text-gray-400">{sub.time.split(' ')[0]}</span>
                </div>
                <div className="p-4">
                  <p className="text-xs text-gray-500 mb-2 font-bold">å…³è”ä»»åŠ¡: {task?.title}</p>
                  
                  {sub.note && (
                    <div className="bg-yellow-50 p-2 rounded text-xs text-gray-600 mb-3 border border-yellow-100 flex items-start gap-1">
                        <FileText size={12} className="mt-0.5 shrink-0 text-yellow-600"/>
                        <span><span className="font-bold">å‘˜å·¥å¤‡æ³¨ï¼š</span>{sub.note}</span>
                    </div>
                  )}

                  <div className="w-full h-32 bg-gray-100 rounded-lg flex items-center justify-center mb-4 border border-dashed border-gray-300 relative group">
                    <div className="text-gray-400 text-xs flex flex-col items-center">
                       <ImageIcon size={24} className="mb-1"/>
                       [æˆªå›¾å‡­è¯é¢„è§ˆ]
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <button 
                      onClick={() => onAudit(sub.id, 'rejected')}
                      className="flex-1 py-2 border border-red-200 text-red-500 rounded-lg text-sm font-medium hover:bg-red-50"
                    >
                      é©³å›
                    </button>
                    <button 
                      onClick={() => onAudit(sub.id, 'approved')}
                      className="flex-1 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 shadow-md shadow-indigo-200"
                    >
                      é€šè¿‡
                    </button>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}

// ä»»åŠ¡ç®¡ç†ç»„ä»¶ï¼šå¢åˆ æ”¹æŸ¥
function AdminTaskMgr({ tasks, onCreateTask, onUpdateTask, onDeleteTask }) {
  const [isEditing, setIsEditing] = useState(false);
  const [showForm, setShowForm] = useState(false);
  const [taskFilter, setTaskFilter] = useState('active'); // active, closed
  const [formData, setFormData] = useState({ id: null, title: '', desc: '', points: 10, deadline: '', type: 'æœ‹å‹åœˆ', taskImage: null });

  const resetForm = () => {
    setFormData({ id: null, title: '', desc: '', points: 10, deadline: '', type: 'æœ‹å‹åœˆ', taskImage: null });
    setIsEditing(false);
    setShowForm(false);
  };

  const startEdit = (task) => {
    setFormData(task);
    setIsEditing(true);
    setShowForm(true);
  };

  const handleSubmit = () => {
    if(!formData.title) return;
    const taskToSave = {
        ...formData,
        // å¦‚æœæ˜¯æ–°ä»»åŠ¡ï¼Œç¡®ä¿çŠ¶æ€æ˜¯ active
        status: isEditing ? formData.status : 'active'
    };

    if (isEditing) {
      onUpdateTask(taskToSave);
    } else {
      onCreateTask(taskToSave);
    }
    resetForm();
  };

  const displayedTasks = tasks.filter(t => taskFilter === 'active' ? t.status === 'active' : t.status === 'closed');

  return (
    <div className="p-4 pb-20">
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-lg font-bold text-gray-800">ä»»åŠ¡ç®¡ç†</h2>
        <button 
          onClick={() => { resetForm(); setShowForm(true); }}
          className="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-sm flex items-center gap-1 shadow hover:bg-indigo-700"
        >
          <Plus size={16} /> å‘å¸ƒä»»åŠ¡
        </button>
      </div>

      <div className="flex bg-white p-1 rounded-lg shadow-sm border border-gray-100 mb-4">
        <button onClick={() => setTaskFilter('active')} className={`flex-1 py-1.5 text-xs font-medium rounded transition ${taskFilter === 'active' ? 'bg-indigo-100 text-indigo-700' : 'text-gray-500'}`}>
            è¿›è¡Œä¸­
        </button>
        <button onClick={() => setTaskFilter('closed')} className={`flex-1 py-1.5 text-xs font-medium rounded transition ${taskFilter === 'closed' ? 'bg-gray-200 text-gray-700' : 'text-gray-500'}`}>
            å·²ç»“æŸ/è¿‡æœŸ
        </button>
      </div>

      {showForm && (
        <div className="bg-white p-4 rounded-xl shadow-lg border border-indigo-100 mb-6 animate-fade-in-down z-20 relative">
          <div className="flex justify-between items-center mb-3">
             <h3 className="text-sm font-bold text-gray-800">{isEditing ? 'ç¼–è¾‘ä»»åŠ¡' : 'æ–°å»ºä»»åŠ¡'}</h3>
             <button onClick={resetForm} className="text-gray-400 hover:text-gray-600"><XCircle size={18} /></button>
          </div>
          <div className="space-y-3">
            <input 
              placeholder="ä»»åŠ¡æ ‡é¢˜" 
              className="w-full text-sm border p-2 rounded focus:ring-1 focus:ring-indigo-500 outline-none"
              value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})}
            />
            <textarea 
              placeholder="ä»»åŠ¡æè¿°..." 
              className="w-full text-sm border p-2 rounded h-20 focus:ring-1 focus:ring-indigo-500 outline-none"
              value={formData.desc} onChange={e => setFormData({...formData, desc: e.target.value})}
            />
            {/* æ¨¡æ‹Ÿä¸Šä¼ å›¾ç‰‡ */}
            <div 
                className={`border-2 border-dashed rounded p-3 text-center cursor-pointer ${formData.taskImage ? 'border-indigo-400 bg-indigo-50' : 'border-gray-300'}`}
                onClick={() => setFormData({...formData, taskImage: formData.taskImage ? null : 'placeholder_url'})}
            >
                {formData.taskImage ? (
                    <span className="text-xs text-indigo-600 flex items-center justify-center gap-1"><CheckCircle size={12}/> å·²æ·»åŠ ç¤ºä¾‹å›¾ (ç‚¹å‡»ç§»é™¤)</span>
                ) : (
                    <span className="text-xs text-gray-400 flex items-center justify-center gap-1"><ImageIcon size={12}/> æ·»åŠ ä»»åŠ¡ç¤ºä¾‹å›¾ (é€‰å¡«)</span>
                )}
            </div>

            <div className="flex gap-2">
              <input 
                type="number" placeholder="ç§¯åˆ†" 
                className="w-1/3 text-sm border p-2 rounded"
                value={formData.points} onChange={e => setFormData({...formData, points: parseInt(e.target.value)})}
              />
              <select 
                className="w-2/3 text-sm border p-2 rounded"
                value={formData.type} onChange={e => setFormData({...formData, type: e.target.value})}
              >
                <option>æœ‹å‹åœˆ</option>
                <option>ç¤¾ç¾¤</option>
                <option>ç§ä¿¡</option>
                <option>å…¶ä»–</option>
              </select>
            </div>
            <input 
                type="date" 
                className="w-full text-sm border p-2 rounded"
                value={formData.deadline} onChange={e => setFormData({...formData, deadline: e.target.value})}
            />
            <button onClick={handleSubmit} className="w-full bg-black text-white py-2 rounded-lg text-sm font-medium hover:opacity-90">
              {isEditing ? 'ä¿å­˜ä¿®æ”¹' : 'ç¡®è®¤å‘å¸ƒ'}
            </button>
          </div>
        </div>
      )}

      <div className="space-y-3">
        {displayedTasks.length === 0 ? <p className="text-center text-gray-400 text-sm py-4">æš‚æ— {taskFilter === 'active' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}ä»»åŠ¡</p> : displayedTasks.map(task => (
          <div key={task.id} className={`bg-white p-4 rounded-xl border border-gray-200 flex justify-between items-start ${task.status === 'closed' ? 'opacity-70 bg-gray-50' : ''}`}>
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-1">
                 <div className="font-bold text-gray-800 text-sm">{task.title}</div>
                 {task.taskImage && <ImageIcon size={12} className="text-indigo-400"/>}
              </div>
              <div className="text-xs text-gray-500 mb-1 line-clamp-2">{task.desc}</div>
              <div className="text-xs text-indigo-600 font-medium flex items-center gap-2">
                <span>{task.points}åˆ†</span>
                <span>|</span>
                <span>{task.type}</span>
                <span>|</span>
                <span className={task.status === 'closed' ? 'text-red-500' : ''}>æˆªæ­¢: {task.deadline}</span>
              </div>
            </div>
            <div className="flex gap-2 ml-2">
              <button onClick={() => startEdit(task)} className="p-1.5 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200">
                <Edit size={14} />
              </button>
              <button onClick={() => onDeleteTask(task.id)} className="p-1.5 bg-red-50 text-red-500 rounded-lg hover:bg-red-100">
                <Trash2 size={14} />
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// äººå‘˜ç®¡ç†ç»„ä»¶ï¼šå¢åˆ æ”¹æŸ¥
function AdminUserMgr({ users, onAddUser, onUpdateUser, onDeleteUser }) {
  const [showForm, setShowForm] = useState(false);
  const [isEditing, setIsEditing] = useState(false);
  const [formData, setFormData] = useState({ id: '', name: '', role: 'employee', password: '' });

  const resetForm = () => {
    setFormData({ id: '', name: '', role: 'employee', password: '' });
    setIsEditing(false);
    setShowForm(false);
  };

  const startEdit = (user) => {
    setFormData({ ...user, password: '' }); // ç¼–è¾‘æ—¶ä¸è‡ªåŠ¨å›å¡«å¯†ç ï¼Œé™¤éæƒ³ä¿®æ”¹
    setIsEditing(true);
    setShowForm(true);
  };

  const handleSubmit = () => {
    if (!formData.id || !formData.name) return;
    
    // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ä¸”å¯†ç ä¸ºç©ºï¼Œåˆ™ä¸ä¿®æ”¹å¯†ç 
    const userToSubmit = { ...formData };
    if (isEditing && !userToSubmit.password) {
        delete userToSubmit.password;
    }

    if (isEditing) {
      onUpdateUser(userToSubmit);
    } else {
      onAddUser(userToSubmit);
    }
    resetForm();
  };

  // è¿‡æ»¤æ‰å½“å‰ç®¡ç†å‘˜è‡ªå·±ï¼Œé˜²æ­¢è¯¯åˆ 
  const managedUsers = users.filter(u => u.id !== 'admin');

  return (
    <div className="p-4 pb-20">
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-lg font-bold text-gray-800">äººå‘˜ç®¡ç†</h2>
        <button 
          onClick={() => { resetForm(); setShowForm(true); }}
          className="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-sm flex items-center gap-1 shadow hover:bg-indigo-700"
        >
          <Plus size={16} /> æ·»åŠ å‘˜å·¥
        </button>
      </div>

      {showForm && (
        <div className="bg-white p-4 rounded-xl shadow-lg border border-indigo-100 mb-6 animate-fade-in-down">
          <div className="flex justify-between items-center mb-3">
             <h3 className="text-sm font-bold text-gray-800">{isEditing ? 'ç¼–è¾‘å‘˜å·¥' : 'å½•å…¥æ–°å‘˜å·¥'}</h3>
             <button onClick={resetForm} className="text-gray-400 hover:text-gray-600"><XCircle size={18} /></button>
          </div>
          <div className="space-y-3">
            <input 
              placeholder="å§“å" 
              className="w-full text-sm border p-2 rounded focus:ring-1 focus:ring-indigo-500 outline-none"
              value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})}
            />
            <input 
              placeholder="å·¥å· (ID)" 
              className="w-full text-sm border p-2 rounded focus:ring-1 focus:ring-indigo-500 outline-none"
              value={formData.id} 
              onChange={e => setFormData({...formData, id: e.target.value})}
              disabled={isEditing} // å·¥å·é€šå¸¸ä½œä¸ºä¸»é”®ä¸å¯ä¿®æ”¹
            />
             <div className="relative">
                <input 
                  placeholder={isEditing ? "å¯†ç  (ç•™ç©ºåˆ™ä¸ä¿®æ”¹)" : "å¯†ç  (é»˜è®¤ä¸º 123456)"}
                  className="w-full text-sm border p-2 rounded focus:ring-1 focus:ring-indigo-500 outline-none"
                  value={formData.password} 
                  onChange={e => setFormData({...formData, password: e.target.value})}
                />
                <Lock size={14} className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
            </div>
            <select 
              className="w-full text-sm border p-2 rounded"
              value={formData.role} onChange={e => setFormData({...formData, role: e.target.value})}
            >
              <option value="employee">æ™®é€šå‘˜å·¥</option>
              <option value="admin">ç®¡ç†å‘˜</option>
            </select>
            <button onClick={handleSubmit} className="w-full bg-black text-white py-2 rounded-lg text-sm font-medium hover:opacity-90">
              {isEditing ? 'ä¿å­˜ä¿®æ”¹' : 'ç¡®è®¤æ·»åŠ '}
            </button>
          </div>
        </div>
      )}

      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {managedUsers.map((u) => (
          <div key={u.id} className="p-4 border-b border-gray-100 flex justify-between items-center last:border-0">
            <div className="flex items-center gap-3">
               <div className="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-xl">
                 {u.avatar || 'ğŸ‘¤'}
               </div>
               <div>
                 <div className="font-medium text-gray-800 text-sm">{u.name}</div>
                 <div className="text-xs text-gray-500">å·¥å·: {u.id} | {u.role === 'admin' ? 'ç®¡ç†å‘˜' : 'å‘˜å·¥'}</div>
               </div>
            </div>
            <div className="flex gap-2">
              <button onClick={() => startEdit(u)} className="p-2 text-gray-400 hover:text-indigo-600 bg-gray-50 rounded-lg">
                <Edit size={16} />
              </button>
              <button onClick={() => onDeleteUser(u.id)} className="p-2 text-gray-400 hover:text-red-500 bg-gray-50 rounded-lg">
                <Trash2 size={16} />
              </button>
            </div>
          </div>
        ))}
        {managedUsers.length === 0 && (
          <div className="p-6 text-center text-gray-400 text-sm">æš‚æ— å‘˜å·¥æ•°æ®</div>
        )}
      </div>
    </div>
  );
}

function AdminStats({ users }) {
  return (
    <div className="p-4 pb-20">
      <h2 className="text-lg font-bold text-gray-800 mb-4">æ•°æ®æŠ¥è¡¨</h2>
      <div className="bg-indigo-600 rounded-xl p-6 text-white mb-4 shadow-lg">
        <div className="text-indigo-200 text-sm mb-1">å›¢é˜Ÿæ€»ç§¯åˆ†äº§å‡º</div>
        <div className="text-3xl font-bold">{users.reduce((acc, curr) => acc + curr.points, 0)}</div>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <table className="w-full text-sm text-left">
          <thead className="bg-gray-50 text-gray-500">
            <tr>
              <th className="p-3">å§“å</th>
              <th className="p-3">å·¥å·</th>
              <th className="p-3 text-right">ç§¯åˆ†</th>
            </tr>
          </thead>
          <tbody>
            {users.filter(u => u.role !== 'admin').map((u, i) => (
              <tr key={u.id} className="border-t border-gray-100">
                <td className="p-3 font-medium">{u.name}</td>
                <td className="p-3 text-gray-500">{u.id}</td>
                <td className="p-3 text-right font-bold text-indigo-600">{u.points}</td>
              </tr>
            ))}
          </tbody>
        </table>
        <div className="p-3 border-t border-gray-100 text-center">
          <button className="text-xs text-indigo-600 font-medium flex items-center justify-center gap-1 w-full">
            <DownloadIcon size={12}/> å¯¼å‡º Excel æŠ¥è¡¨
          </button>
        </div>
      </div>
    </div>
  );
}

// --- åº•éƒ¨å¯¼èˆª ---
function BottomNav({ role, activeTab, setActiveTab, pendingCount }) {
  const navItemClass = (tabName) => 
    `flex flex-col items-center justify-center w-full h-full space-y-1 ${activeTab === tabName ? (role === 'admin' ? 'text-indigo-600' : 'text-blue-600') : 'text-gray-400'}`;

  if (role === 'admin') {
    return (
      <div className="h-16 bg-white border-t border-gray-200 flex justify-around items-center shrink-0 z-20">
        <button onClick={() => setActiveTab('audit')} className={navItemClass('audit')}>
          <div className="relative">
            <CheckCircle size={24} />
            {pendingCount > 0 && <span className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center">{pendingCount}</span>}
          </div>
          <span className="text-[10px]">å®¡æ ¸</span>
        </button>
        <button onClick={() => setActiveTab('tasks')} className={navItemClass('tasks')}>
          <ClipboardList size={24} />
          <span className="text-[10px]">ä»»åŠ¡</span>
        </button>
        <button onClick={() => setActiveTab('users')} className={navItemClass('users')}>
          <Users size={24} />
          <span className="text-[10px]">äººå‘˜</span>
        </button>
        <button onClick={() => setActiveTab('stats')} className={navItemClass('stats')}>
          <BarChart3 size={24} />
          <span className="text-[10px]">æŠ¥è¡¨</span>
        </button>
      </div>
    );
  }

  return (
    <div className="h-16 bg-white border-t border-gray-200 flex justify-around items-center shrink-0 z-20">
      <button onClick={() => setActiveTab('tasks')} className={navItemClass('tasks')}>
        <ClipboardList size={24} />
        <span className="text-[10px]">ä»»åŠ¡å¤§å…</span>
      </button>
      <button onClick={() => setActiveTab('rank')} className={navItemClass('rank')}>
        <Trophy size={24} />
        <span className="text-[10px]">é¾™è™æ¦œ</span>
      </button>
      <button onClick={() => setActiveTab('profile')} className={navItemClass('profile')}>
        <User size={24} />
        <span className="text-[10px]">æˆ‘çš„</span>
      </button>
    </div>
  );
}

// ç®€å•çš„ä¸‹è½½å›¾æ ‡ç»„ä»¶
const DownloadIcon = ({size}) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
    <polyline points="7 10 12 15 17 10" />
    <line x1="12" y1="15" x2="12" y2="3" />
  </svg>
);